<!doctype html><html lang=en><head><meta charset=utf-8><title>04: Injection (pt 1)</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section data-noprocess data-shortcode-slide class=center><h1 id=week04>Week04</h1><p>Thanks Lachlan and Andrew for some content</p></section><section><h2 id=review>Review</h2><p>Any questions about previous content?</p></section><section><h2 id=content>Content</h2><ul><li>Injection<ul><li>SQLi</li><li>SSTI</li></ul></li><li>SSRF</li></ul></section><section><h2 id=injection>Injection</h2><p>Injection attacks occur when an attacker injects malicious data that is then used to control program behaviour</p></section><section><section data-shortcode-section><h2 id=sql>SQL</h2><p>Structured Query Language</p><ul><li>Language for querying databases</li><li>Implementations include:<ul><li>PostgreSQL</li><li>MySQL</li><li>SQLite</li><li>SQL Server (Microsoft)</li></ul></li></ul></section><section><h2 id=sql-statements>SQL Statements</h2><ul><li>SELECT _ FROM _ &mldr;</li><li>INSERT INTO _ (COLn, &mldr;) VALUES (VALn, &mldr;)</li><li>UPDATE _ SET _ = _ &mldr;</li><li>DELETE FROM _ &mldr;</li><li>&mldr; &ndash; this is a comment</li><li>&mldr; # this can also be a comment (sometimes)
â€¦</li></ul></section><section><h2 id=sql-syntax>SQL Syntax</h2><ul><li><p>WHERE</p><ul><li>> - greater than</li><li>&lt; - less than</li><li>= - equal to</li><li>&lt;> - not equal to</li></ul></li><li><p>LIKE</p><ul><li>% - wildcard</li></ul></li><li><p>UNION
&mldr;</p></li></ul></section><section><h3 id=more-sql-syntax>More SQL Syntax</h3><ul><li>ORDER BY</li><li>GROUP BY</li><li>DISTINCT</li><li>LIMIT</li><li>OFFSET</li></ul><h2 id=demo>Demo</h2><h2 id=demohttpswwww3schoolscomsqltrysqlaspfilenametrysql_asc><a href="https://www.w3schools.com/sql/trysql.asp?filename=trysql_asc">Demo</a></h2></section></section><section><section data-shortcode-section><h2 id=sqli>SQLi</h2><p>what?</p><ul><li>User input contains control characters that interfere with the SQL statement</li></ul><p>Why?</p><ul><li>Bad programmers - The user input is being trusted to be a valid format.</li></ul></section><section><h2 id=sqli-1>SQLi</h2><h4 id=code-before-injection>Code before injection</h4><p><code>SELECT a FROM b WHERE a = '$userInput'</code></p><h4 id=code-after-injection>Code after injection</h4><p><code>vvvvvvvvvvvvv SELECT a FROM b WHERE a = '' OR '1' = '1' ^^^^^^^^^^^^^</code></p></section><section><h2 id=sqli-2>SQLi</h2><p>What can you do with SQLi?</p><ul><li>Bypass logins</li><li>Leak data</li><li>Spoof a user</li><li>Modify data (don&rsquo;t try in 6443)</li></ul></section><section><h2 id=sqli-3>SQLi</h2><p>You should be asking:</p><ul><li>How can we tell what implementation is being used?</li><li>How do we know what tables/columns exist?</li></ul></section><section><h2 id=fingerprinting>Fingerprinting</h2><ul><li>Different implementations will have different artifacts<ul><li><strong>MySQL</strong>: Version()</li><li><strong>SQLite</strong>: sqlite_version()</li><li><strong>SQL Server</strong>: @@Version</li></ul></li><li>Seem more <a href=https://www.sqlinjection.net/database-fingerprinting/>here</a> and <a href=https://portswigger.net/web-security/sql-injection/examining-the-database>here</a></li></ul></section><section><h2 id=schema-recon>Schema Recon</h2><ul><li><p>what tables exist, what do they look like?</p><ul><li><strong>MySQL</strong>: <code>information*schema.[tables|columns]</code></li><li><strong>SQLite</strong>: <code>sqlite*[master|schema]</code></li><li><strong>SQL Server</strong>: <code>SHOW TABLES; DESCRIBE &lt;table_name></code></li></ul></li></ul></section><section><h1 id=demo>Demo</h1><p>Thanks Andrew</p></section></section><section><h2 id=sqli-mitigation>SQLi Mitigation</h2><ul><li>Disable debug logging<ul><li>No error messages, maybe just a blank screen?</li></ul></li><li>WAF - Web Application Firewalls<ul><li>Reject/strip malicious payloads</li></ul></li><li>Parameterised Queries</li></ul></section><section><h2 id=beating-mitigations>Beating Mitigations</h2><ul><li>Payload stripped? Embed dummies</li><li>Blank response? Side channel attacks<ul><li>Timing Attacks</li><li>Out of Band Attacks i.e inbuilt functions (therefore fingerprint!)</li></ul></li><li>Error-based extraction</li><li>Boolean-based extraction</li><li>Subqueries<ul><li>SELECT a,b FROM c WHERE d UNION SELECT (SELECT &mldr;), 2</li></ul></li></ul></section><section><h2 id=remember>Remember</h2><ul><li>The payloads can be complex</li><li>Reporting a vulnerability != extracting data</li><li>Big database? - COUNT or LIMIT + OFFSET it instead</li><li>No SQLmap or automated SQL enumeration/exploitation</li><li>Don&rsquo;t try to DROP any tables</li></ul></section><section><section data-shortcode-section><h2 id=other-injection>Other Injection</h2><h3 id=ssti>SSTI</h3><p>Server side template injection</p><ul><li>Jinja</li><li>Twig</li><li>Plates</li></ul></section><section><h2 id=ssti-example>SSTI Example</h2><p>In the backend:
<code>output = template.render(name=request.args.get('name'))</code></p><p>Attacker requests:
<code>http://vulnerable-website.com/?name={{bad-stuff}}</code></p><p><code>bad-stuff</code> could be code to execute</p></section><section><h2 id=ssti-demo>SSTI Demo</h2><p>Thanks Lachlan</p></section></section><section><section data-shortcode-section><h2 id=ssrf>SSRF</h2><p>Server-side request forgery</p><ul><li>HaaS</li><li>Making a server in the target network make request on your behalf</li><li>Used to access servers that might not be public</li><li>Some servers trust internal requests (bad authz)</li></ul></section><section><h2 id=why-ssrf>Why SSRF</h2><p>Utilising functionalities of a server to access resources</p><ul><li>Information retrieval</li><li>Can lead to RCE</li><li>Server Side Includes</li><li>Horizontal/vertical priv. esc.</li></ul></section><section><h2 id=mitigation>Mitigation</h2><ul><li>Whitelist domains and IPs!</li><li>Lower the access control of services</li><li>Set limits! exec time, file sizes, recursion depth</li><li>Zero Trust<ul><li>Local devices should NOT be assumed to be safe</li></ul></li></ul></section></section><section></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>